<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CarCommand Elite v12.3 - Final Version</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --c-void: #000000;
            --c-plasma: #00ffcc;
            --c-stellar: #7c3aed;
            --c-critical: #ff0033;
            --glass: rgba(12, 12, 18, 0.96);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--c-void);
            color: #f8fafc;
            background-image: radial-gradient(circle at 50% 0%, rgba(124, 58, 237, 0.15) 0%, transparent 50%);
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
        }

        .font-orbitron { font-family: 'Orbitron', sans-serif; }

        .glass-obsidian {
            background: var(--glass);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .mobile-nav-container {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            z-index: 100;
            background: linear-gradient(to top, #000 90%, transparent);
            padding: 0.5rem 1rem 1.5rem 1rem;
            display: none;
        }

        @media (max-width: 1024px) { 
            .mobile-nav-container { display: block; } 
            .desktop-only { display: none !important; }
        }

        @media (min-width: 1025px) {
            .mobile-only { display: none !important; }
            .content-tab { display: grid !important; } /* Siempre visible en escritorio */
        }

        .nav-tab {
            flex: 1;
            padding: 0.5rem 0.25rem;
            text-align: center;
            font-size: 8px;
            font-weight: 800;
            color: #4b5563;
            text-transform: uppercase;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .nav-tab.active { color: var(--c-plasma); }
        .nav-tab i { font-size: 1.1rem; display: block; margin-bottom: 0.2rem; }

        .plasma-text {
            background: linear-gradient(90deg, #fff, var(--c-plasma));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        @keyframes pulse-red { 0% { opacity: 0.4; } 50% { opacity: 1; } 100% { opacity: 0.4; } }
        .critical-pulse { animation: pulse-red 1.5s infinite; color: var(--c-critical); }

        select, input, textarea {
            background-color: #0a0a0a !important;
            color: white !important;
            border: 1px solid rgba(255,255,255,0.1) !important;
        }

        .btn-action {
            color: white !important;
            background: linear-gradient(135deg, var(--c-stellar), #5b21b6);
            cursor: pointer;
        }

        .status-fill { height: 100%; transition: width 1s ease-in-out; }
        
        .component-card {
            border-left: 4px solid var(--c-plasma);
            transition: all 0.3s ease;
        }
        .component-card.is-critical { border-left-color: var(--c-critical); }
        
        ::-webkit-scrollbar { width: 3px; }
        ::-webkit-scrollbar-thumb { background: var(--c-plasma); }
    </style>
</head>
<body class="p-4 lg:p-12 lg:pb-12 pb-32">

    <div class="max-w-[1600px] mx-auto space-y-8 lg:space-y-12">
        
        <header class="flex flex-col lg:flex-row justify-between items-center lg:items-start gap-6">
            <div class="text-center lg:text-left">
                <h1 class="text-4xl md:text-8xl font-orbitron font-black tracking-tighter plasma-text uppercase">
                    CarCommand<span class="text-white opacity-20">SN</span>
                </h1>
                <p class="font-mono text-[8px] lg:text-[9px] tracking-[0.5em] text-gray-600 uppercase">Universal Engine Sovereignty • v12.3</p>
            </div>

            <div class="glass-obsidian px-6 lg:px-10 py-4 lg:py-6 rounded-3xl border-t border-t-white/10 flex gap-6 lg:gap-10 items-center">
                <div class="text-center">
                    <p class="text-[8px] text-plasma font-bold uppercase tracking-widest">Sensores</p>
                    <div id="main-odometer" class="text-2xl lg:text-4xl font-orbitron font-bold text-white tracking-widest">---</div>
                </div>
                <div class="flex flex-col gap-1">
                    <button onclick="changeUnit('KM')" id="btn-km" class="text-[9px] font-black border border-white/10 px-3 py-1 rounded-full transition-all">KM</button>
                    <button onclick="changeUnit('ML')" id="btn-ml" class="text-[9px] font-black border border-white/10 px-3 py-1 rounded-full transition-all">ML</button>
                </div>
            </div>
        </header>

        <section id="tab-inicio" class="glass-obsidian rounded-[2rem] lg:rounded-[3rem] p-6 lg:p-10 grid grid-cols-1 xl:grid-cols-5 gap-8 border border-white/5 content-tab">
            <div class="xl:col-span-4 grid grid-cols-1 md:grid-cols-3 gap-4 lg:gap-6">
                <div class="space-y-1">
                    <label class="text-[8px] font-bold text-gray-500 uppercase">Marca</label>
                    <select id="v-brand" onchange="updateModels()" class="w-full rounded-xl p-3 lg:p-5 text-sm font-bold"></select>
                </div>
                <div class="space-y-1">
                    <label class="text-[8px] font-bold text-gray-500 uppercase">Modelo</label>
                    <select id="v-model" class="w-full rounded-xl p-3 lg:p-5 text-sm font-bold"></select>
                </div>
                <div class="space-y-1">
                    <label class="text-[8px] font-bold text-gray-500 uppercase">Odómetro Consola</label>
                    <input type="number" id="v-km" class="w-full rounded-xl p-3 lg:p-5 text-xl font-mono text-plasma">
                </div>
                <div class="grid grid-cols-2 gap-4 md:col-span-2">
                    <div class="space-y-1">
                        <label class="text-[8px] font-bold text-gray-500 uppercase">Tracción</label>
                        <select id="v-drive" class="w-full rounded-xl p-3 lg:p-4 text-xs font-bold">
                            <option value="4x2">Sencilla (4x2)</option>
                            <option value="4x4">All-Terrain (4x4)</option>
                            <option value="awd">AWD</option>
                        </select>
                    </div>
                    <div class="space-y-1">
                        <label class="text-[8px] font-bold text-gray-500 uppercase">Transmisión</label>
                        <select id="v-trans" class="w-full rounded-xl p-3 lg:p-4 text-xs font-bold">
                            <option value="manual">Manual</option>
                            <option value="auto">Automática</option>
                            <option value="cvt">CVT</option>
                            <option value="dsg">DSG/DCT</option>
                        </select>
                    </div>
                </div>
                <div class="flex items-end">
                    <button onclick="syncVehicle()" class="w-full btn-action py-4 lg:py-5 rounded-xl font-black uppercase text-[10px] tracking-widest text-white shadow-lg shadow-purple-500/20">Sincronizar Nave</button>
                </div>
            </div>

            <div class="flex flex-row xl:flex-col items-center justify-between xl:justify-center gap-4 border-t xl:border-t-0 xl:border-l border-white/5 pt-6 xl:pt-0 xl:pl-10">
                <div class="text-left xl:text-center">
                    <p class="text-[8px] text-gray-600 font-bold uppercase">Integridad</p>
                    <h3 id="health-percent" class="text-4xl lg:text-5xl font-orbitron font-black text-white">0%</h3>
                </div>
                <div id="health-indicator" class="w-5 h-5 rounded-full bg-gray-900 shadow-lg"></div>
            </div>
        </section>

        <div id="categories-container" class="space-y-12 lg:space-y-24"></div>
    </div>

    <div class="mobile-nav-container glass-obsidian mobile-only">
        <div class="flex justify-around items-center">
            <div onclick="switchTab('Inicio')" class="nav-tab active" id="tab-btn-inicio"><i class="fas fa-house"></i>Inicio</div>
            <div onclick="switchTab('Soporte Vital')" class="nav-tab" id="tab-btn-fluidos"><i class="fas fa-droplet"></i>Fluidos</div>
            <div onclick="switchTab('Potencia')" class="nav-tab" id="tab-btn-potencia"><i class="fas fa-gears"></i>Potencia</div>
            <div onclick="switchTab('Combustión')" class="nav-tab" id="tab-btn-fire"><i class="fas fa-fire"></i>Motor</div>
            <div onclick="switchTab('Chasis')" class="nav-tab" id="tab-btn-chasis"><i class="fas fa-shield"></i>Chasis</div>
        </div>
    </div>

    <div id="modal" class="fixed inset-0 bg-black/98 z-[200] hidden items-center justify-center">
        <div class="glass-obsidian max-w-4xl w-full h-full md:h-auto overflow-y-auto rounded-none md:rounded-[4rem] p-6 md:p-12 space-y-6 md:space-y-10">
            <div class="flex justify-between items-start">
                <div>
                    <p id="modal-cat" class="text-[9px] text-plasma font-bold uppercase tracking-[0.4em] mb-1"></p>
                    <h3 id="modal-title" class="text-2xl md:text-4xl font-orbitron font-black text-white uppercase tracking-tighter"></h3>
                </div>
                <button onclick="closeModal()" class="text-white p-2 hover:text-plasma transition-colors"><i class="fas fa-times fa-2xl"></i></button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-12">
                <div class="space-y-6">
                    <div class="bg-white/5 p-4 rounded-2xl">
                        <h4 class="text-[9px] font-black text-plasma uppercase mb-2 tracking-widest">¿Para qué sirve?</h4>
                        <p id="modal-desc" class="text-xs text-gray-400 leading-relaxed"></p>
                    </div>
                    <div class="bg-white/5 p-4 rounded-2xl">
                        <h4 class="text-[9px] font-black text-plasma uppercase mb-2 tracking-widest">Protocolo Técnico</h4>
                        <p id="modal-how" class="text-xs text-gray-400 leading-relaxed"></p>
                    </div>
                </div>
                
                <div class="space-y-6 bg-purple-900/10 p-6 rounded-[2rem] border border-white/5">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="text-[9px] font-bold text-gray-500 uppercase tracking-widest">Valor Odómetro</label>
                            <input type="number" id="m-km" class="w-full rounded-2xl p-4 text-2xl font-mono text-plasma text-center">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[9px] font-bold text-gray-500 uppercase tracking-widest">Fecha</label>
                            <input type="date" id="m-date" class="w-full rounded-2xl p-4 text-center text-sm">
                        </div>
                    </div>
                    <button onclick="confirmService()" class="w-full btn-action py-5 rounded-2xl font-black uppercase text-[10px] tracking-widest text-white">Registrar Intervención</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const DATABASE = {
            "Mitsubishi": ["Montero Sport GDI", "L200 Triton", "Outlander", "Montero Limited", "ASX", "Pajero Full", "Eclipse Cross", "Lancer", "L300", "Mirage", "Xpander", "Fuso"],
            "Toyota": ["Hilux", "Prado", "Land Cruiser 300", "Corolla Cross", "Rav4", "4Runner", "Tacoma", "Tundra", "Yaris", "Fortuner", "Hiace"],
            "Nissan": ["Frontier Pro-4X", "Patrol Y62", "X-Trail", "Qashqai", "Kicks", "Sentra", "Pathfinder", "NV350", "Versa", "Terra"],
            "Ford": ["Ranger Raptor", "F-150 Lightning", "Explorer", "Everest", "Mustang", "Bronco", "Territory", "Transit", "Focus", "Fiesta"],
            "Hyundai": ["Tucson", "Santa Fe", "Palisade", "Creta", "Kona", "Staria", "H100", "Accent", "Elantra"],
            "Isuzu": ["D-Max", "MU-X", "NPR", "FTR", "FVR"],
            "Suzuki": ["Jimny 5-Door", "Grand Vitara", "Swift Sport", "S-Cross", "Baleno", "Ertiga", "Carry"],
            "BMW": ["X5 M-Sport", "X3", "Serie 3 M", "Serie 5", "X7", "iX Electric", "M2 Competition"],
            "Mercedes-Benz": ["Clase G 63", "GLE", "GLC", "Clase C", "Clase S", "Sprinter", "Vito"],
            "Land Rover": ["Defender 110", "Range Rover Sport", "Discovery", "Evoque"],
            "Audi": ["Q7 Quattro", "Q5", "A4", "A6", "e-tron Sportback"]
        };

        const SCHEMA = [
            // SOPORTE VITAL
            { id: 'oil', name: 'Aceite Motor Sintético', cat: 'Soporte Vital', km: 8000, icon: 'fa-droplet', desc: 'Lubricante primario que mitiga la entropía térmica y fricción.', how: 'Drenar fluido caliente. Cambiar filtro microscópico y rellenar según viscosidad SAE.' },
            { id: 'brake_f', name: 'Líquido de Frenos', cat: 'Soporte Vital', km: 30000, icon: 'fa-circle-dot', desc: 'Fluido higroscópico. Absorbe humedad reduciendo su punto de ebullición.', how: 'Purgar sistema desde el caliper más alejado hasta que salga fluido cristalino.' },
            { id: 'coolant', name: 'Líquido Refrigerante', cat: 'Soporte Vital', km: 40000, icon: 'fa-temperature-low', desc: 'Evita erosión galvánica y deformación de la culata por calor.', how: 'Realizar flush completo. Rellenar con mezcla 50/50 desmineralizada.' },
            { id: 'trans_f', name: 'Fluido Transmisión', cat: 'Soporte Vital', km: 60000, icon: 'fa-gears', desc: 'Lubrica componentes internos. Crítico para la fricción en CVTs/DSGs.', how: 'Drenar fluido, sustituir filtro interno y nivelar a temperatura específica.' },
            { id: 'diff_f', name: 'Valvulina Diferenciales', cat: 'Soporte Vital', km: 40000, icon: 'fa-truck-monster', desc: 'Protege engranajes hipoides bajo presiones extremas.', how: 'Retirar tapón magnético. Rellenar con API GL-5 hasta el borde superior.' },
            { id: 'transfer', name: 'Aceite Transfer Case', cat: 'Soporte Vital', km: 40000, icon: 'fa-shuffle', drive: '4x4', desc: 'Lubrica cadenas y engranajes de distribución de par en 4x4.', how: 'Vaciado por gravedad y rellenado con fluido de transferencia certificado.' },
            { id: 'power_s', name: 'Fluido Dirección Hidráulica', cat: 'Soporte Vital', km: 40000, icon: 'fa-dharmachakra', desc: 'Lubrica la cremallera y permite la asistencia de giro.', how: 'Succionar fluido del depósito y rellenar con fluido nuevo compatible.' },

            // POTENCIA
            { id: 'timing', name: 'Kit de Distribución', cat: 'Potencia', km: 100000, icon: 'fa-ring', desc: 'Sincroniza pistones y válvulas. El fallo destruye el motor por impacto.', how: 'Sustituir correa/cadena, tensores y bomba de agua simultáneamente.' },
            { id: 'u_joints', name: 'Engrase de Crucetas', cat: 'Potencia', km: 10000, icon: 'fa-cross', desc: 'Mantiene la flexibilidad del eje de transmisión. Expulsa humedad.', how: 'Inyectar grasa NGLI No. 2 por los Zerks hasta expulsar grasa vieja.' },
            { id: 'belt_a', name: 'Correa de Accesorios', cat: 'Potencia', km: 60000, icon: 'fa-bezier-curve', desc: 'Mueve alternador y compresor AC.', how: 'Verificar grietas. Ajustar tensión o reemplazar si hay polimerización.' },
            { id: 'clutch', name: 'Fluido de Embrague', cat: 'Potencia', km: 30000, icon: 'fa-clutch', trans: 'manual', desc: 'Fluido hidráulico para el accionamiento del pedal.', how: 'Purgar el cilindro esclavo para eliminar humedad y aire del circuito.' },

            // COMBUSTIÓN
            { id: 'spark', name: 'Bujías (Iridium)', cat: 'Combustión', km: 50000, icon: 'fa-bolt-lightning', desc: 'Genera el arco para combustión. Desgastadas causan alto consumo.', how: 'Retirar bobinas, extraer bujías viejas y calibrar el electrodo.' },
            { id: 'air_f', name: 'Filtro de Aire Motor', cat: 'Combustión', km: 20000, icon: 'fa-wind', desc: 'Bloquea partículas abrasivas. Sucio, reduce potencia drásticamente.', how: 'Sustituir el elemento. Limpiar caja de admisión de polvo.' },
            { id: 'fuel_f', name: 'Filtro de Combustible', cat: 'Combustión', km: 20000, icon: 'fa-gas-pump', desc: 'Protege inyectores de sedimentos del tanque.', how: 'Despresurizar sistema y sustituir elemento filtrante OEM.' },
            { id: 'valves', name: 'Limpieza GDI / Válvulas', cat: 'Combustión', km: 40000, icon: 'fa-volcano', desc: 'Elimina depósitos de carbón causados por inyección directa.', how: 'Tratamiento químico descarbonizante por inducción o limpieza mecánica.' },

            // CHASIS
            { id: 'tires', name: 'Rotación de Llantas', cat: 'Chasis', km: 10000, icon: 'fa-arrows-spin', desc: 'Compensa el desgaste irregular. Maximiza vida útil.', how: 'Rotación cruzada y balanceo electrónico de las 4 ruedas.' },
            { id: 'shocks', name: 'Amortiguadores', cat: 'Chasis', km: 60000, icon: 'fa-arrows-up-down', desc: 'Mantienen contacto neumático-asfalto y absorben impactos.', how: 'Inspección de fugas y bujes. Sustitución en pares por eje.' },
            { id: 'pads', name: 'Pastillas de Freno', cat: 'Chasis', km: 25000, icon: 'fa-shoe-prints', desc: 'Material de fricción esencial para detener el activo.', how: 'Inspección de espesor. Cambio si el material es inferior a 3mm.' },
            { id: 'hoses', name: 'Mangueras (Caucho)', cat: 'Chasis', km: 80000, icon: 'fa-hose', desc: 'Inspección de polimerización (grietas) por calor extremo.', how: 'Revisión táctil. Sustitución si hay hinchazón o dureza excesiva.' },
            { id: 'srs', name: 'Inspección SRS Airbags', cat: 'Chasis', km: 0, icon: 'fa-person-burst', desc: 'Autodiagnóstico de ignitores y sensores de seguridad pasiva.', how: 'Escaneo electrónico y revisión de testigos en tablero.' },
            { id: 'battery', name: 'Prueba CCA Batería', cat: 'Chasis', km: 1, icon: 'fa-car-battery', desc: 'Verificar capacidad de arranque y carga de alternador.', how: 'Medición de voltaje y prueba de descarga bajo carga.' },
            { id: 'ac_filter', name: 'Filtro de Cabina', cat: 'Chasis', km: 15000, icon: 'fa-snowflake', desc: 'Filtra el aire del habitáculo contra polvo y polen.', how: 'Sustituir el filtro ubicado tras la guantera.' }
        ];

        let state = { unit: 'KM', vehicle: { brand: '', model: '', drive: '4x2', trans: 'manual', km: 0 }, history: {}, activeTab: 'Inicio' };
        const RATIO = 0.621371;

        function init() {
            const saved = localStorage.getItem('carcommand_sn_v12_3');
            if (saved) state = JSON.parse(saved);
            
            const bSel = document.getElementById('v-brand');
            bSel.innerHTML = '<option value="">MARCA</option>' + Object.keys(DATABASE).sort().map(b => `<option value="${b}" ${b===state.vehicle.brand?'selected':''}>${b.toUpperCase()}</option>`).join('');
            
            if(state.vehicle.brand) updateModels();
            document.getElementById('v-km').value = state.vehicle.km || '';
            document.getElementById('v-drive').value = state.vehicle.drive;
            document.getElementById('v-trans').value = state.vehicle.trans;
            
            render();
        }

        function updateModels() {
            const b = document.getElementById('v-brand').value;
            if(!b) return;
            document.getElementById('v-model').innerHTML = DATABASE[b].map(m => `<option value="${m}" ${m===state.vehicle.model?'selected':''}>${m.toUpperCase()}</option>`).join('');
        }

        function changeUnit(u) {
            state.unit = u;
            render();
            save();
        }

        function syncVehicle() {
            const b = document.getElementById('v-brand').value;
            const m = document.getElementById('v-model').value;
            const kmRaw = parseInt(document.getElementById('v-km').value) || 0;
            if(!b || !m) return alert("Configure Marca y Modelo.");
            state.vehicle = { brand: b, model: m, drive: document.getElementById('v-drive').value, trans: document.getElementById('v-trans').value, km: kmRaw };
            if(window.innerWidth < 1024) state.activeTab = 'Soporte Vital';
            save(); render();
        }

        function render() {
            const container = document.getElementById('categories-container');
            const inicioTab = document.getElementById('tab-inicio');
            container.innerHTML = '';
            
            const isMobile = window.innerWidth < 1024;
            if(isMobile) inicioTab.style.display = state.activeTab === 'Inicio' ? 'grid' : 'none';
            else inicioTab.style.display = 'grid';

            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            const tabIdMap = { 'Inicio': 'tab-btn-inicio', 'Soporte Vital': 'tab-btn-fluidos', 'Potencia': 'tab-btn-potencia', 'Combustión': 'tab-btn-fire', 'Chasis': 'tab-btn-chasis' };
            document.getElementById(tabIdMap[state.activeTab])?.classList.add('active');

            if(!state.vehicle.brand && state.activeTab !== 'Inicio' && isMobile) {
                container.innerHTML = '<div class="text-center py-20 text-gray-700 font-orbitron text-xs px-10 tracking-[0.3em]">SINCRONICE EN INICIO</div>';
                return;
            }

            document.getElementById('main-odometer').textContent = state.vehicle.km ? state.vehicle.km.toLocaleString() : '---';
            document.getElementById('btn-km').className = `px-4 py-1 text-[9px] font-black rounded-full ${state.unit === 'KM' ? 'bg-plasma text-black shadow-[0_0_10px_#00ffcc]' : 'text-gray-500'}`;
            document.getElementById('btn-ml').className = `px-4 py-1 text-[9px] font-black rounded-full ${state.unit === 'ML' ? 'bg-plasma text-black shadow-[0_0_10px_#00ffcc]' : 'text-gray-500'}`;

            const cats = [...new Set(SCHEMA.map(i => i.cat))];
            const catsToShow = isMobile ? [state.activeTab] : cats;

            if(isMobile && state.activeTab === 'Inicio') return;

            let hSum = 0, hCount = 0;

            catsToShow.forEach(cat => {
                if(cat === 'Inicio') return;
                const items = SCHEMA.filter(i => i.cat === cat);
                let html = `<div class="space-y-6">
                    <div class="flex items-center gap-4"><h2 class="text-[10px] font-orbitron text-purple-400 uppercase tracking-[0.5em] whitespace-nowrap">${cat}</h2><div class="w-full h-px bg-white/5"></div></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6">`;
                
                items.forEach(item => {
                    if (item.drive && item.drive !== state.vehicle.drive && state.vehicle.drive !== 'awd') return;
                    if (item.trans && item.trans !== state.vehicle.trans) return;

                    const rec = state.history[item.id] || { km: 0 };
                    const interval = state.unit === 'KM' ? item.km : Math.round(item.km * RATIO);
                    const nextKm = rec.km + interval;
                    const remaining = nextKm - state.vehicle.km;
                    const isCrit = remaining <= 0;
                    const progress = Math.max(0, Math.min(100, ((state.vehicle.km - rec.km) / interval) * 100));

                    hSum += (100 - progress); hCount++;

                    html += `<div class="glass-obsidian p-6 md:p-8 rounded-[2rem] component-card ${isCrit ? 'is-critical' : ''} group">
                        <div class="flex justify-between items-start mb-6">
                            <div class="w-12 h-12 rounded-2xl bg-white/5 flex items-center justify-center text-plasma"><i class="fas ${item.icon} fa-2xl"></i></div>
                            <button onclick="openModal('${item.id}')" class="w-10 h-10 rounded-full border border-white/10 flex items-center justify-center bg-white/5 text-white active:bg-plasma active:text-black"><i class="fas fa-plus text-xs"></i></button>
                        </div>
                        <h4 class="text-xs font-black uppercase mb-1 text-white">${item.name}</h4>
                        <p class="text-[9px] text-gray-500 font-mono">LÍMITE: ${nextKm.toLocaleString()} ${state.unit}</p>
                        <div class="mt-8 space-y-3">
                            <div class="flex justify-between text-[9px] font-bold"><span>${progress.toFixed(0)}%</span><span class="${isCrit ? 'text-red-600 critical-pulse' : 'text-gray-500'}">${isCrit ? 'CRÍTICO' : remaining.toLocaleString() + ' REST'}</span></div>
                            <div class="h-1 bg-white/5 rounded-full overflow-hidden"><div class="status-fill" style="width: ${progress}%; background: ${isCrit ? '#ff0033' : '#00ffcc'}"></div></div>
                        </div>
                    </div>`;
                });
                container.innerHTML += html + '</div></div>';
            });
            
            const totalH = hCount > 0 ? Math.round(hSum / hCount) : 100;
            document.getElementById('health-percent').textContent = `${totalH}%`;
            document.getElementById('health-indicator').className = `w-5 h-5 rounded-full ${totalH < 50 ? 'bg-red-600 critical-pulse shadow-[0_0_15px_#ff0033]' : 'bg-plasma shadow-[0_0_15px_#00ffcc]'}`;
        }

        function switchTab(cat) { state.activeTab = cat; render(); }
        let activeId = null;
        function openModal(id) {
            activeId = id;
            const item = SCHEMA.find(i => i.id === id);
            document.getElementById('modal-title').textContent = item.name;
            document.getElementById('modal-cat').textContent = item.cat;
            document.getElementById('modal-desc').textContent = item.desc;
            document.getElementById('modal-how').textContent = item.how;
            document.getElementById('m-km').value = state.vehicle.km;
            document.getElementById('m-date').value = dayjs().format('YYYY-MM-DD');
            document.getElementById('modal').style.display = 'flex';
        }
        function closeModal() { document.getElementById('modal').style.display = 'none'; }
        function confirmService() {
            const val = parseInt(document.getElementById('m-km').value);
            state.history[activeId] = { km: val, date: document.getElementById('m-date').value };
            if(val > state.vehicle.km) { state.vehicle.km = val; document.getElementById('v-km').value = val; }
            save(); render(); closeModal();
        }
        function save() { localStorage.setItem('carcommand_sn_v12_3', JSON.stringify(state)); }
        window.onresize = render;
        init();
    </script>
</body>
</html>


